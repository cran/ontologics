<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Map new concepts</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Map new concepts</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ontologics)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>When an ontology exists already, it can be used either by looking up
which concepts exist in it, which relations the concepts have among each
other, by adding and linking new concepts to the already existing
concepts or by extending the harmonised concepts based on external
ontologies.</p>
<div id="relate-an-external-ontology-to-harmonized-concepts" class="section level2">
<h2>Relate an external ontology to harmonized concepts</h2>
<p>When adding (or mapping) new concepts, we first have to define the
source of the new concepts.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># already existing ontology for some project about crops</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">load_ontology</span>(<span class="at">path =</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;crops.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;ontologics&quot;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># where we have to set the external dataset as new source</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">new_source</span>(<span class="at">name =</span> <span class="st">&quot;externalDataset&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">version =</span> <span class="st">&quot;0.0.1&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">description =</span> <span class="st">&quot;a vocabulary&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">homepage =</span> <span class="st">&quot;https://www.something.net&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">license =</span> <span class="st">&quot;CC-BY-4.0&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ontology =</span> crops)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># new concepts that occur in the external dataset, which should be harmonised with the ontology</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>externalConcepts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Wheat&quot;</span>, <span class="st">&quot;NUTS&quot;</span>, <span class="st">&quot;Avocado&quot;</span>))</span></code></pre></div>
<p>The new concepts are from different conceptual levels, both ‘Wheat’
and ‘Avocado’ are the crop itself, while ‘NUTS’ is an aggregate of
various crops (such as walnut, hazelnut, etc). Let’s first find out
whether these concepts are in fact new concepts because they are missing
from the ontology.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>missingConcepts <span class="ot">&lt;-</span> <span class="fu">get_concept</span>(<span class="at">table =</span> externalConcepts, <span class="at">ontology =</span> crops)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(missingConcepts)</span></code></pre></div>
<table>
<colgroup>
<col width="12%" />
<col width="8%" />
<col width="11%" />
<col width="8%" />
<col width="9%" />
<col width="16%" />
<col width="16%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">external</th>
<th align="left">match</th>
<th align="left">label</th>
<th align="left">class</th>
<th align="left">id</th>
<th align="left">has_broader</th>
<th align="left">description</th>
<th align="left">has_source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Wheat</td>
<td align="left">exact</td>
<td align="left">Wheat</td>
<td align="left">class</td>
<td align="left">.02.09</td>
<td align="left">.02</td>
<td align="left">NA</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">NUTS</td>
<td align="left">exact</td>
<td align="left">NUTS</td>
<td align="left">group</td>
<td align="left">.10</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">Avocado</td>
<td align="left">exact</td>
<td align="left">Avocado</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<p>This tells us that that both ‘NUTS’ and ‘Wheat’ don’t seem to be
missing from the ontology. Moreover, we see that ‘Wheat’ is a
<em>class</em> and not a <em>crop</em> and ‘NUTS’ also isn’t
<em>crop</em> and doesn’t have any <em>broader</em> concept. While
Avocado is missing from the ontology entirely, the crop Wheat is also
missing, hence both have to be defined as new concept.</p>
<p>By studying the ontology (not shown here), we can identify the
semantic relation between the new concepts and some of the already
harmonized concepts. First of all, to assign new concepts from an
external ontology, a harmonised concept must already exist in the
harmonised ontology. For the new harmonized concepts, we chose the lower
capital letter words to show the difference between those and the
external concepts and we assign them as narrower concepts to the
respective already existing, harmonized (broader) concepts.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>broaderConcepts <span class="ot">&lt;-</span> <span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Wheat&quot;</span>, <span class="st">&quot;Tropical and subtropical Fruit&quot;</span>)), </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ontology =</span> crops)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">new_concept</span>(<span class="at">new =</span> <span class="fu">c</span>(<span class="st">&quot;wheat&quot;</span>, <span class="st">&quot;avocado&quot;</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">broader =</span> broaderConcepts,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">class =</span> <span class="st">&quot;crop&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ontology =</span> crops)</span></code></pre></div>
<p>Eventually, all new (external) concepts can be mapped to already
harmonized concepts. Even though ‘NUTS’ already exists, this also
applies to this new concept, because the already existing concept ‘NUTS’
doesn’t necessarily have to be the same as the new concept ‘NUTS’. This
all depends on the respective description of the harmonized and external
concepts. When setting a new mapping, the type and the certainty of the
match have to be defined. As we have defined the closely related
concepts as new concepts, we can chose a <em>close</em> match for all
external concepts. Certainty has the value 3, because it is <em>clear,
assigned according to a given definition</em>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>toMap <span class="ot">&lt;-</span> <span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;wheat&quot;</span>, <span class="st">&quot;NUTS&quot;</span>, <span class="st">&quot;avocado&quot;</span>)),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ontology =</span> crops)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">new_mapping</span>(<span class="at">new =</span> externalConcepts <span class="sc">%&gt;%</span> <span class="fu">pull</span>(label),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">target =</span> toMap,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">match =</span> <span class="fu">c</span>(<span class="st">&quot;close&quot;</span>, <span class="st">&quot;close&quot;</span>, <span class="st">&quot;close&quot;</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">source =</span> <span class="st">&quot;externalDataset&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">certainty =</span> <span class="dv">3</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ontology =</span> crops)</span></code></pre></div>
</div>
<div id="extend-the-classes" class="section level2">
<h2>Extend the classes</h2>
<p>It may be, moreover, that we want to (or have to) add new concepts,
that do not have a class defined yet. This can be the case when we have
to nest new concepts, out of a range of concepts that do have a valid
class, into concepts that are already at the lowest possible
hierarchical level. These concepts are, when specified with
<code>class = NA</code>, <code>class = c(bla, blubb, NA)</code>, or
<code>class = NULL</code>, assigned the actual class
<code>undefined</code> and you are informed about how to proceed.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>broaderConcepts <span class="ot">&lt;-</span> <span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;wheat&quot;</span>, <span class="st">&quot;wheat&quot;</span>)),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ontology =</span> crops)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for (some of) these concepts we do not know the class ...</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">new_concept</span>(<span class="at">new =</span> <span class="fu">c</span>(<span class="st">&quot;wheat1&quot;</span>, <span class="st">&quot;wheat2&quot;</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">broader =</span> broaderConcepts,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">class =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ontology =</span> crops)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: some new concepts (wheat1, wheat2) don&#39;t have a class; please define</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this with &#39;new_class()&#39; and re-run &#39;new_concept()&#39; with these concepts and the</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; new class.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="st">&quot;Wheat&quot;</span>), <span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_tree</span>(<span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">label</th>
<th align="left">description</th>
<th align="left">class</th>
<th align="left">has_broader</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">.02.09</td>
<td align="left">Wheat</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.02</td>
</tr>
<tr class="even">
<td align="left">.02.09.01</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">crop</td>
<td align="left">.02.09</td>
</tr>
<tr class="odd">
<td align="left">.02.09.01.01</td>
<td align="left">wheat1</td>
<td align="left">NA</td>
<td align="left">undefined</td>
<td align="left">.02.09.01</td>
</tr>
<tr class="even">
<td align="left">.02.09.01.02</td>
<td align="left">wheat2</td>
<td align="left">NA</td>
<td align="left">undefined</td>
<td align="left">.02.09.01</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ... ok, then let&#39;s specify that class and re-run new_concept</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">new_class</span>(<span class="at">new =</span> <span class="st">&quot;cultivar&quot;</span>, <span class="at">target =</span> <span class="st">&quot;crop&quot;</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">description =</span> <span class="st">&quot;type of plant that people have bred for desired traits&quot;</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ontology =</span> crops)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>crops <span class="ot">&lt;-</span> <span class="fu">new_concept</span>(<span class="at">new =</span> <span class="fu">c</span>(<span class="st">&quot;wheat1&quot;</span>, <span class="st">&quot;wheat2&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">broader =</span> broaderConcepts,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">class =</span> <span class="st">&quot;cultivar&quot;</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ontology =</span> crops)</span></code></pre></div>
<p>Now we can check whether the updated ontology is as we’d expect, for
example by looking at the tree of the respective items again. We should
expect that the new harmonized concepts now appear in the ontology and
that they have some link to an external concept defined.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="st">&quot;Wheat&quot;</span>), <span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_tree</span>(<span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="17%" />
<col width="9%" />
<col width="16%" />
<col width="12%" />
<col width="16%" />
<col width="27%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">label</th>
<th align="left">description</th>
<th align="left">class</th>
<th align="left">has_broader</th>
<th align="left">has_close_match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">.02.09</td>
<td align="left">Wheat</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.02</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">.02.09.01</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">crop</td>
<td align="left">.02.09</td>
<td align="left">externalDataset_1.3</td>
</tr>
<tr class="odd">
<td align="left">.02.09.01.03</td>
<td align="left">wheat1</td>
<td align="left">NA</td>
<td align="left">cultivar</td>
<td align="left">.02.09.01</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">.02.09.01.04</td>
<td align="left">wheat2</td>
<td align="left">NA</td>
<td align="left">cultivar</td>
<td align="left">.02.09.01</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="st">&quot;NUTS&quot;</span>), <span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_tree</span>(<span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="16%" />
<col width="17%" />
<col width="8%" />
<col width="17%" />
<col width="29%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">label</th>
<th align="left">description</th>
<th align="left">class</th>
<th align="left">has_broader</th>
<th align="left">has_close_match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">.10</td>
<td align="left">NUTS</td>
<td align="left">NA</td>
<td align="left">group</td>
<td align="left">NA</td>
<td align="left">externalDataset_2.3</td>
</tr>
<tr class="even">
<td align="left">.10.01</td>
<td align="left">Treenuts</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">.10.02</td>
<td align="left">Other nuts</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.10</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_concept</span>(<span class="at">table =</span> <span class="fu">tibble</span>(<span class="at">label =</span> <span class="st">&quot;FRUIT&quot;</span>), <span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_tree</span>(<span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="34%" />
<col width="13%" />
<col width="6%" />
<col width="13%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">label</th>
<th align="left">description</th>
<th align="left">class</th>
<th align="left">has_broader</th>
<th align="left">has_close_match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">.06</td>
<td align="left">FRUIT</td>
<td align="left">NA</td>
<td align="left">group</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">.06.01</td>
<td align="left">Berries</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">.06.02</td>
<td align="left">Citrus Fruit</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">.06.03</td>
<td align="left">Grapes</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">.06.04</td>
<td align="left">Pome Fruit</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">.06.05</td>
<td align="left">Stone Fruit</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">.06.06</td>
<td align="left">Tropical and subtropical Fruit</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">.06.06.01</td>
<td align="left">avocado</td>
<td align="left">NA</td>
<td align="left">crop</td>
<td align="left">.06.06</td>
<td align="left">externalDataset_3.3</td>
</tr>
<tr class="odd">
<td align="left">.06.07</td>
<td align="left">Other fruit</td>
<td align="left">NA</td>
<td align="left">class</td>
<td align="left">.06</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and finally a list of all external concepts</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_concept</span>(<span class="at">external =</span> <span class="cn">TRUE</span>, <span class="at">ontology =</span> crops) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">label</th>
<th align="left">description</th>
<th align="left">has_source</th>
<th align="left">has_broader</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">externalDataset_1</td>
<td align="left">Wheat</td>
<td align="left">NA</td>
<td align="left">2</td>
<td align="left">.02.09</td>
</tr>
<tr class="even">
<td align="left">externalDataset_2</td>
<td align="left">NUTS</td>
<td align="left">NA</td>
<td align="left">2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">externalDataset_3</td>
<td align="left">Avocado</td>
<td align="left">NA</td>
<td align="left">2</td>
<td align="left">.06.06</td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
